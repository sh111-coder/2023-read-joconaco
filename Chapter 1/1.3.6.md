# 1.3.6 💻 테스트가 용이한 코드를 작성하고 제대로 테스트하라

## 🎯 1. 테스트가 중요한 이유
테스트는 버그와 제대로 동작하지 않는 기능을 가지고 있는 코드가

실제 서비스 환경에서 실행되지 않도록 하는 프로세스의 중요한 요소이다.

테스트는 2가지 핵심 사항에 대한 주된 방어 수단이 될 때가 많다.

```java
1. 버그나 제대로 동작하지 않는 기능을 갖는 코드가 코드베이스에 병합되지 않도록 방지

2. 버그나 제대로 동작하지 않는 기능을 갖는 코드가 배포되지 않도록 막고,
   서비스 환경에서 실행되지 않도록 보장
```
**따라서 테스트는 코드가 동작하고, 멈추지 않고 계속 잘 실행되는 것을 보장하기 위해 필수적이다!**

테스트가 중요한 이유는 다음과 같다.
```java
1. 소프트웨어 시스템과 코드베이스는 너무 크고 복잡해서 한 사람이 모든 세부 사항을 알 수 없다.
2. 사람은 실수를 하는 존재이다.
```

---
## 🎯 2. 테스트와 테스트 용이성의 차이
테스트와 테스트 용이성은 서로 관련이 있지만 고려하는 사항이 다르다.

### ⚙️ 2-1. 테스트(test)
이름에서 알 수 있듯이 코드 or 소프트웨어 전체를 테스트하는 것과 관련이 있다.

개발자는 일반적으로 테스트 코드를 통해 ‘실제’ 코드를 돌려보고,

모든 기능이 정상적으로 작동하는지 확인하고 이것을 자동화하기위해 노력한다.

테스트는 여러 수준이 존재하는데, 보통 다음 3가지 테스트를 많이 볼 수 있다.

<br>

- **2-1-1. 단위 테스트(Unit test)**

일반적으로 **개별 함수나 클래스와 같은 작은 단위의 코드**를 테스트한다.

<br>

- **2-1-2. 통합 테스트(Integration test)**

시스템은 일반적으로 여러 구성 요소, 모듈, 하위 시스템으로 구성되는데,

이러한 구성 요소와 하위 시스템을 함께 연결하는 과정을 **통합(Integeration)**이라고 한다.

이러한 통합 과정을 테스트하는 것이 통합테스트이다.

통합 테스트를 통해 이러한 여러 구성 요소들이 제대로 작동하고, 멈추지 않고 실행되는지 확인할 수 있다.

ex) DB를 사용하는 기능일 때, 실제 DB와 기능이 연결이 되었는지 테스트

<br>

- **2-1-3. 종단간 테스트(end-to-end, E2E test)**

처음부터 끝까지 전체 소프트웨어 시스템에서 작동의 흐름을 테스트한다.

테스트하는 소프트웨어가 온라인 쇼핑몰이라면,

웹 브라우저 자동 구동 → 사용자 구매 완료까지의 과정이 정상적으로 진행되는지 테스트하는 것이 예이다.

<br>

### ⚙️ 2-2. 테스트 용이성(testability)
이것은 테스트 코드와 반대로 테스트 대상이 되는 ‘실제’ 코드에 관련된 속성으로,

**해당 코드가 얼마나 테스트하기 적합한지를 나타낸다.**

테스트 용이성은 **모듈화**와 관련이 깊다.

모듈화된 코드는 테스트 용이성이 더 좋다. (테스트하기 더 적합하다)

예시로 비상 보행자 브레이크 시스템을 개발하려고 하는 상황 예시를 들 수 있다.

<br>

- **2-2-1. 모듈화되어 있지 않다면?**

이 시스템이 모듈화되어 있지 않고, 실제 자동차에 종속적으로 존재한다면

이 시스템을 테스트하는 유일한 방법은 실제 자동차에 시스템을 설치하고,

보행자가 있는 도로에서 차를 운전해서 자동차가 자동으로 멈추는지 확인하는 것이다.

이렇게 하게되면 테스트 비용이 너무 커지게 된다.

자동차를 조립하고, 테스트 트랙을 임대하고, 실제 사람이 보행자인 것처럼 하는 위험을 감수해야한다.

<br>

- **2-2-2. 모듈화 되어 있다면?**

비상 브레이크 시스템이 실제 자동차 밖에서 작동할 수 있는,

실제 자동차와 독립적인 별개의 모듈로 존재한다면 훨씬 쉽게 테스트가 가능하다.

이 경우에는 보행자가 발을 내딛는 장면을 미리 녹화한 비디오로 보여주고,

브레이크 시스템을 위해 올바른 신호를 출력하는지 확인함으로써 테스트할 수 있다.

이렇게 하게되면 테스트 비용이 매우 저렴하고, 리스크도 적다.

---
## 🎯 3. 테스트 용이성을 코드 작성 시에 항상 확인하자!
코드의 테스트 용이성이 낮으면 제대로 테스트하는 것이 불가능할 수 있다.

따라서, 프로덕션 코드를 작성할 때 현재 코드의 테스트 용이성을 확인하기 위해

**‘어떻게 테스트할 것인가?’를 계속 자문하는 것이 좋다!**

예를 들면, 랜덤 테스트같은 경우에

랜덤 기능을 가지는 프로덕션 코드를 작성할 때 다음과 같은 사고 과정을 거치는 것이 좋을 것 같다!
```java
1. 랜덤 기능인데 어떻게 테스트할까? (테스트 용이성이 좋은 코드일까?, 테스트하기 쉬울까?)
2. 테스트하기 어려워 보이니 테스트 용이성을 높이기 위해 다른 방법을 찾아보자!
3. '의존성 주입'을 활용해서 테스트 용이성을 높여보자!
```

이러한 사고 과정이 코드를 다 작성하고 나서 이뤄지면 안된다.

**즉, 코드를 작성한 후에 테스트 용이성을 떠올리는 것이 아닌, 작성하기 전이나 작성 시점에 떠올려야 한다!**
